---
title: "【WordPress】403エラー＝WAFとは限らない！API連携でハマった意外な落とし穴 (PREP法)"
slug: "wp-api-403-not-waf"
status: "draft"
categories: 
  - "Troubleshooting"
  - "WordPress"
tags: 
  - "Lolipop"
  - "SiteGuard"
  - "REST API"
featured_image: "../images/2025/403-error-1.png"
---

# 結論：WAFを疑う前に「SiteGuard」を見ろ

こんにちは、ZIDOOKA! です。
WordPressのREST APIを使って画像をアップロードしようとしたら、**403 Forbidden** エラーが出ました。

「あー、はいはいWAFね。ロリポップあるある。」
と思ってWAFログを見に行ったら……**ログがない。**

そう、**原因はWAFではありませんでした。**

## 理由：セキュリティプラグインがAPIをブロックしている

ロリポップなどのレンタルサーバーでは、**「SiteGuard WP Plugin」** がプリインストールされていることが多いです。
このプラグインには **「REST API無効化」** や **「WAFチューニングサポート」** という機能があり、これらが外部からのAPI接続を遮断していることがあります。

## 具体例：403エラーの犯人探し

今回遭遇した現象はこうです。

1.  Node.jsから画像をアップロードしようとする。
2.  `403 Forbidden` が返ってくる。
3.  ロリポップのWAFログを見る → **記録なし**。
4.  `.htaccess` を確認する → 問題なし。

そこで「SiteGuard」の設定画面を確認したところ……。

![SiteGuardの設定](../images/2025/403-error-2.png)

こいつです。
特に **「ログインしていないユーザーのREST APIアクセスを制限する」** といった設定がONになっていると、Application Passwordsを使っていても弾かれることがあります。

## 結論：エラー画面だけを信じるな

「403エラー ＝ WAF」という思い込みは危険です。
特に画像アップロードや外部ツール連携で詰まったときは、以下の順で疑いましょう。

## 追記：WAFを無効にしてもダメな場合がある (2025/12/11)

さらに調査を進めたところ、**WAFを完全に無効化しても403エラーが消えないケース** がありました（特に英語の記事を投稿しようとした際）。
これはサーバー側（Lolipopなど）の **スパムフィルター** や、WAFとは別のセキュリティ層が、特定のキーワードや大量の英語テキストを検知してブロックしている可能性があります。

この場合、**「一度空の下書きを作成してから、中身を更新する」** という2段階の投稿方法をとることで回避できました。
APIを一発で叩くのではなく、小分けにすることでセキュリティチェックをすり抜けられることがあるようです。

1.  **WAF** (サーバーパネル)
2.  **SiteGuard** (プラグイン)
3.  **ディレクトリ権限** (755/644)

今回はSiteGuardの設定を見直すことで解決しました。
同じ罠にハマっている人の助けになれば幸いです。
